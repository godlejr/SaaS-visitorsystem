{% extends 'bootstrap/base.html' %}
{% block content %}
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script>
$(document).ready(function () {
     //URL에 해당하는 컨트롤러 호출
     function apiCallGet(url, controller, option) {
          $.ajax({
               url: url,
               method: "GET"
          })
               .done(function (dataSet) {
                    controller(dataSet, option);
               })
               .fail(function (xhr, status, errorThrown) {
                    console.log(errorThrown);
               })
     }

     function apiCallPost(url, controller, data, option) {
          $.ajax({
               type: 'POST',
               url: url,
               async: false,
               cache: false,
               data: data
          })
               .success(function (data) {
                    controller(data);
               });
     }



     //type에 맞는 URL을 반환하는 함수
     function urlMake(url, args) {
          var reqUrl = "/inoutApply/";
          switch (url) {
               case "CAMERA_PLAY":
                    var cameraName = args[0];//카메라 play reqUrl = `/camera/play?cameraName=${cameraName}`;
                    break;

               case 'CREATE':
                    reqUrl = reqUrl + `create`;
                    break;

               case 'INTERVIEW_SEARCH':
                    reqUrl = reqUrl + `interview/search`;
                    break;
          }
          return reqUrl;
     }


     //출입신청 컨트롤러
     function applyController(dataSet) {

          console.log(JSON.stringify(dataSet));

     }

     //감독자조회 컨트롤러
     function interViewSearchController(dataSet) {

        console.log(JSON.stringify(dataSet));

    }

     //event리스너
     function init() {
     const $tableID = $('#table');
     const newTr = `
     <tr class="hide">
       <td>
            <input type="checkbox" id="checkbox" class="peer">
       </td>

       <td>
			<input type="text" class="form-control" style="width:80%; float:left" >
			<button type="button" class="btn btn-primary" style="float:right" data-toggle="modal" data-target="#visitModal">
			     <i class="search-icon ti-search pdd-right-10"></i>
			</button>
        </td>

       <td>
            <input type="text" class="form-control">
       </td>

       <td>
            <select class="form-control">
                            <option selected="selected">차량없음</option>
                            <option value="승용차">승용차</option>
                            <option value="승합차">승합차</option>
                            <option value="버스">버스</option>
                            <option value="트럭">트럭</option>
                            <option value="TANK_LORRY">TANK_LORRY</option>
                            <option value="TANK_TRAILER">TANK_TRAILER</option>
             </select>
       </td>

       <td>
            <input type="text" class="form-control">
       </td>

       <td>
            <select class="form-control">
                            <option selected="selected">O</option>
                            <option value="승용차">X</option>
             </select>
       </td>

     </tr>`;


          $('#appylbtn').click(function () {
               var htmlIdList = [];
               var dataSet = {};
               htmlIdList = ['applicant_name', 'applicant_phone', 'applicant_biz_no',
                    'applicant_comp_nm', 'interviewer_name', 'interviewer_phone',
                    'inout_biz_no', 'inout_comp_nm', 'inout_sdate',
                    'inout_edate', 'inout_comp_nm', 'inout_sdate',
                    'inout_purpose_type', 'inout_title', 'inout_location',
                    'inout_location_desc', 'inout_purpose_desc'
               ]

               for (var i = 0; i < htmlIdList.length; i++) {
                    var key = htmlIdList[i];
                    var value = $('#' + key).val()
                    dataSet[key] = value;
               }

               apiCallPost(urlMake('CREATE'), applyController, dataSet)
          });

          $('#addUser').click(function (e) {
             const $clone = $tableID.find('tbody tr').last().clone(true).removeClass('hide table-line');
               if ($tableID.find('tbody tr').length === 0) {
                    $('#tableBody').append(newTr);
               }

               $tableID.find('table').append($clone);
          });

           $('#delUser').click(function (e) {
              var checkbox = $('input[id=checkbox]:checked');
              var tdArray = new Array();

              checkbox.each(function(i){
                    var tr = checkbox.parent().parent().eq(i);
                    var td = tr.children();
                    setTimeout(function(){
                        tr.remove();
                    },100);

              });

          });


          $('#interviewSearch').click(function(e){
               var dataSet = {};
               var interviewName = $('#interviewInput').val();
               dataSet['interviewName'] = interviewName;
               apiCallPost(urlMake('INTERVIEW_SEARCH'), interViewSearchController, dataSet)

          });
     }

     init();

});




</script>

<div id="mainContent">
    {% block mainContent %}

    {% endblock%}
</div>
{% endblock%}