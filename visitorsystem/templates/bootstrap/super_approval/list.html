{% extends "bootstrap/super_approval/approval_modal.html" %}

{% block mainContent %}
<!-- mainContent의 상단 조회조건 설정 부분 -->
<script>
    function url_for(param){
        var sdate = $('#visit_sdate').val();
        var edate = $('#visit_edate').val();
        var dataSet = {};

        if (!sdate || !edate) {
            return;
        }

        sdate = sdate.split('/'); edate = edate.split('/');
        dataSet['visit_sdate'] = sdate[2] + "-" + sdate[0] + "-" + sdate[1];
        dataSet['visit_edate'] = edate[2] + "-" + edate[0] + "-" + edate[1];
        dataSet['visit_category'] = $('#type').val();
        dataSet['visit_purpose'] = $('#visit-purpose').val();
        dataSet['comp_nm'] = $('#comp-nm').val();
        dataSet['approval_state'] = $('#inputState').val();
        dataSet['page'] = 1;    //Search 버튼 누르면 초기페이지는 1번째로 Set
        dataSet['pages'] = 10;  //한 페이지에 조회되는 개수

        document.location.href =  "{{url_for( 'super_approval.index')}}page/" + param +
                                    "?visit_sdate="+ dataSet['visit_sdate'] + "&visit_edate=" + dataSet['visit_edate'] +
                                    "&visit_category=" + dataSet['visit_category'] + "&visit_purpose=" + dataSet['visit_purpose'] +
                                    "&comp_nm=" + dataSet['comp_nm'] + "&approval_state=" + dataSet['approval_state'] +
                                    "&pages=" + dataSet['pages'];
    }
</script>

<div class="mainContent-top">
    <div class="row gap-20 masonry pos-r mR-10" style=" height: 200px;">
        <div class="masonry-sizer col-md-12"></div>
        <div class="masonry-item col-md-12">
            <div class="bgc-white bd p-20 col-md-12">
                <div class="content-top mB-5">
                    <div class="page-header"><h5 class="c-grey-900"> 감독부서업무 > 감독부서 승인 </h5><br></div>
                </div>
                <div class="mT-30">
                </div>
            </div>
            <br>
            <!-- mainContent 최상단 : 페이지 명칭, 버튼 위치-->
            <div class="bgc-white bd p-20">
                <div class="mT-10">
                    <!-- 각 입력값 ID 테이블컬럼명에 맞게 수정 필요 name부분 -->
                    <div id="superApprovalSearchForm">
                        <button type="submit" class="btn cur-p btn-primary mB-10 mR-10 btn-right search-btn"
                                id="searchBtn">조회
                        </button>
                        <div class="form-row">
                            <div class="form-group col-md-4"><label class="fw-500">신청일자</label>
                                <div class="timepicker-input input-icon form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control bdc-grey-200 startDate"
                                               data-provide="datepicker" name="visit_sdate" id="visit_sdate">

                                        <div class="input-group-addon bgc-white bd bdwR-0"><i class="ti-calendar"></i>
                                        </div>
                                        <h6 class="c-grey-900"> &nbsp~&nbsp</h6>

                                        <input type="text" class="form-control bdc-grey-200 ml-20 endDate"
                                               data-provide="datepicker" name="visit_edate" id="visit_edate"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-2"><label for="type">방문유형</label>
                                <select id="type" class="form-control" name="visit_category">
                                    <!-- type1 / type2 / type3 -->
                                    <option selected="selected" value="all">-전체-</option>
                                    {% for list in visitCategory %}
                                    <option name="{{list.code_nm}}">{{list.code_nm}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-3"><label for="visit-purpose">방문목적</label> <input type="text"
                                                                                                            class="form-control"
                                                                                                            id="visit-purpose"
                                                                                                            name="visit_purpose">
                                <input id="visit_purpose" name="visit_purpose" type="hidden" value="hi">
                            </div>

                            <div class="form-group col-md-3"><label for="comp-nm">업체명</label> <input type="text"
                                                                                                     class="form-control"
                                                                                                     id="comp-nm"
                                                                                                     name="comp_nm">
                            </div>
                            <div class="form-group col-md-2"><label for="inputState">진행상태</label>
                                <select id="inputState" class="form-control" name="approval_state">
                                    <!-- all / state0 / state1 / state2-->
                                    <option selected="selected" value="all">-전체-</option>
                                    <option name="승인">승인</option>
                                    <option name="대기">대기</option>
                                    <option name="반려">반려</option>
                                </select></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><br/>

<!-- mainContent의 하단 조회결과 테이블 -->
<div class="mainContent-bottom container-fluid">
    <div class="row gap-20 pos-r">
        <div class="col-md-12">
            <div class="bgc-white bd bdrs-3 p-20">
                <div class="btn_group">
                    <!--                        data-toggle="modal" data-target="#signModal" -->
                    <button type="button" class="btn cur-p btn-primary mR-10 btn-right modal-btn" id="reject">반려</button>
                    <button type="button" class="btn cur-p btn-primary mR-10 btn-right modal-btn" id="agree">승인</button>
                </div>
                <h5 class="c-grey-900 mB-20">출입신청내역</h5>
                <hr/>
                <table id="applyListTable" class="table table-striped table-bordered applyListTable mediaTable" cellspacing="0"
                       width="100%">
                    <thead class="mediaTable">
                    <!-- 변수명 변경 및 컬럼 사이즈 조절 필요함 -->
                    <tr>
                        <td style="width: 30px;"><input type="checkbox" id="checkall"/></td>
                        <td style="width: 80px;">방문유형</td>
                        <td style="width: 130px;">업체명</td>
                        <td style="width: 230px;">출입신청명</td>
                        <td style="width: 140px;">신청자</td>
                        <td style="width: 100px;">출입자정보</td>
                        <td style="width: 120px;">시작일</td>
                        <td style="width: 120px;">종료일</td>
                        <td style="width: 110px;">신청사업장</td>
                        <td style="width: 110px;">신청출입문</td>
                        <td style="width: 120px;">진행단계</td>
                    </tr>
                    </thead>
                    <tbody id="tableBody" class="mediaTable">
                    {% if lists|length < 1 %}
                    <td colspan="12" style="text-align:center">
                        <text> 조회된 내역이 없습니다.</text>
                    </td>
                    {% else %}
                    <!-- 출입신청마스터에서 작업내역 데이터 출력 부분-->
                    {% for list in lists %}
                    <tr>
                        <td><input type="checkbox" name="chk" value1={{list.id}} value2={{list.approval_state}}>{{list.id}}</td>
                        <td>{{list.visit_category}}</td>
                        <td>{{list.sccompinfo.comp_nm}}</td>
                        <td>{{list.visit_purpose}}</td>
                        <td>{{list.applicant}}</td>
                        <td style="text-decoration: underline;" data-toggle="modal" class="guestInfo" name="guestInfo" value={{list.id}}>출입자정보</td>
                        <td>{{list.visit_sdate}}</td>
                        <td>{{list.visit_edate}}</td>
                        <td>{{list.site_nm}}</td>
                        <td>{{list.site_nm2}}</td>
                        <td class="state">{{list.approval_state}}</td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                    </tbody>
                </table>
                <div id="pagination" class="pagination-nav">
                    {{ func.render_pagination('super_approval.index', pagination, id=None, query_string=query_string) }}
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}