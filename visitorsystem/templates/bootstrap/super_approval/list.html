{% extends "bootstrap/super_approval/base.html" %}

{% block mainContent %}
<script>
$(document).ready(function(){
    //체크박스 전체 선택,해제
    $("#checkall").click(function(){
        if($("#checkall").prop("checked")){
            $("input[name=chk]").prop("checked",true);
        }else{
            $("input[name=chk]").prop("checked",false);
        }
    })

    //체크 개수, 승인, 반려 Modal 창에 값 전달하는 부분
    function modalOpen(val) {
        var cnt = $("input:checkbox[name=chk]:checked").length
        $(".appr-name").html(val)
        $(".chkCnt").html(cnt)
    }

    $("#agree").click(function () {
        modalOpen($("#agree").html())
    })

    $("#reject").click(function () {
        modalOpen($("#reject").html())
    })
});
</script>

<!-- mainContent의 상단 조회조건 설정 부분 -->
<div class="mainContent-top">
    <div class="row gap-20 masonry pos-r" style=" height: 200px;">
        <div class="masonry-sizer col-md-12"></div>
        <div class="masonry-item col-md-12" style="position: absolute; left: 50%; top: 0px;">
            <!-- mainContent 최상단 : 페이지 명칭, 버튼 위치-->
            <div class="bgc-white bd p-20 mR-30">
                <div class="mT-10">
                    <!-- 각 입력값 ID 테이블컬럼명에 맞게 수정 필요 name부분 -->
                    <form id="superApprovalSearchForm" method="POST" action="{{ url_for('super_approval.index') }}">
                        <div class="content-top mB-10">
                            <div class="page-header"><h5 class="c-grey-900"> 감독부서업무 > 감독부서 승인 </h5></div>
                            <button type="submit" class="btn cur-p btn-primary mB-10 mR-10 btn-right search-btn">조회</button>
                        </div>
                        <br/>
                        <hr/>
                        <div class="form-row">
                            <div class="form-group col-md-4"><label class="fw-500">신청일자</label>
                                <div class="timepicker-input input-icon form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control bdc-grey-200 startDate"
                                               data-provide="datepicker" name="visit_sdate" id="visit_sdate">

                                        <div class="input-group-addon bgc-white bd bdwR-0"><i class="ti-calendar"></i>
                                        </div>
                                        <h6 class="c-grey-900"> &nbsp~&nbsp</h6>

                                        <input type="text" class="form-control bdc-grey-200 ml-20 endDate"
                                               data-provide="datepicker" name="visit_edate" id="visit_edate"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-2"><label for="type">구분</label>
                                <select id="type" class="form-control" name="visit_category">
                                    <!-- type1 / type2 / type3 -->
                                    <option selected="selected" value="all">-전체-</option>
                                    <option name="업체">업체</option>
                                    <option name="차량">차량</option>
                                    <option name="방문객">방문객</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-3"><label for="work-name">작업명</label> <input type="text"
                                                                                                       class="form-control"
                                                                                                       id="work-name"
                                                                                                       name="apply_nm">
                            </div>
                            <div class="form-group col-md-3"><label for="comp-nm">업체명</label> <input type="text"
                                                                                                           class="form-control"
                                                                                                           id="comp-nm"
                                                                                                           name="comp_nm">
                            </div>
                            <div class="form-group col-md-2"><label for="inputState">진행상태</label>
                                <select id="inputState" class="form-control" name="approval_state">
                                    <!-- all / state0 / state1 / state2-->
                                    <option selected="selected" value="all">-전체-</option>
                                    <option name="승인">승인</option>
                                    <option name="대기">대기</option>
                                    <option name="반려">반려</option>
                                </select></div>
                        </div>
                        {% with messages = get_flashed_messages() %}
                            {#{{render_error_message(form.visit_sdate)}}#}
                            {#{{render_error_message(form.visit_edate)}}#}
                        {% endwith %}
                    </form>
                </div>
            </div>
        </div>
    </div>
</div><br/>

<!-- mainContent의 하단 조회결과 테이블 -->
<div class="mainContent-bottom container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="bgc-white bd bdrs-3 p-20 mB-20">
                <div class="btn_group">
                    <button type="button" class="btn cur-p btn-primary mR-10 btn-right modal-btn test" data-toggle="modal" data-target="#signModal" id="reject">반려</button>
                    <button type="button" class="btn cur-p btn-primary mR-10 btn-right modal-btn test" data-toggle="modal" data-target="#signModal" id="agree">승인</button>
                </div>
                <h5 class="c-grey-900 mB-20">출입신청내역</h5>
                <hr/>
                <table id="dataTable" class="table table-striped table-bordered" cellspacing="0" width="100%">
                    <thead>
                    <!-- 변수명 변경 및 컬럼 사이즈 조절 필요함 -->
                    <tr>
                        <th style="width: 70px;">No</th>
                        <th style="width: 30px;"><input type="checkbox" id="checkall" /></th>
                        <th style="width: 80px;">구분</th>
                        <th style="width: 130px;">업체명</th>
                        <th style="width: 230px;">출입신청명</th>
                        <th style="width: 140px;">신청자</th>
                        <th style="width: 100px;">증빙서류</th>
                        <th style="width: 100px;">출입자정보</th>
                        <th style="width: 100px;">시작일</th>
                        <th style="width: 100px;">종료일</th>
                        <th style="width: 175px;">신청출입문</th>
                        <th style="width: 120px;">진행단계</th>
                    </tr>
                    </thead>
                    <tbody>
                        {% if applyList|length == 0 %}
                            <td colspan="12" style="text-align:center"><text> 조회된 내역이 없습니다. </text></td>
                        {% else %}
                            {% for list in applyList %}
                                <tr>
                                    <td>1</td>
                                    <td><input type="checkbox" name="chk" value="{{list.apply_code}}"></td>
                                    <td>{{list.visit_category}}</td>
                                    <!--방문업체명으로 변경 필요 2021.01.17 -->
                                    <td>{{list.biz_no}}</td>
                                    <td>{{list.apply_nm}}</td>
                                    <td>{{list.applicant}}</td>
                                    <td>
                                        <button type="button" class="btn btn-link btn-md center" data-toggle="modal"
                                                data-target="#visitantDocModal">증빙서류</button>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-link btn-md center" data-toggle="modal"
                                                data-target="#visitantDocModal">출입자정보</button>
                                    </td>
                                    <td>{{list.visit_sdate}}</td>
                                    <td>{{list.visit_edate}}</td>
                                    <td>{{list.site_id}}</td>
                                    <td>{{list.approval_state}}</td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    <tr>
                        <td>1</td>
                        <td><input type="checkbox" name="chk"></td>
                        <td>visit_category</td>
                        <td>comp_nm</td>
                        <td>apply_nm</td>
                        <td>visitant</td>
                        <td>
                            <button type="button" class="btn btn-link btn-md center" data-toggle="modal"
                                    data-target="#visitantDocModal">증빙서류</button>
                        </td>
                        <td>sdate</td>
                        <td>edate</td>
                        <td>site_id</td>
                        <td>approval_state</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!--방문자의 증빙 상세 내역 확인 Modal Div-->
<div id="visitantDocModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
     aria-labelledby="classInfo" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> {{visitant}}님의 증빙 상세 내역 </h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> ×</button>
            </div>
            <div class="modal-body">
                <table id="classTable" class="table table-bordered">
                    <thead class="thead-light">
                    <tr>
                        <th>No</th>
                        <th>규칙구분</th>
                        <th>유형</th>
                        <th>유효기간</th>
                        <th>등록일</th>
                        <th>증빙내역</th>
                        <th>상태</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>1</td>
                        <td>특수검진</td>
                        <td>유형</td>
                        <td>유효기간</td>
                        <td>등록일</td>
                        <td>첨부파일</td>
                        <td>유효</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>사업장 안전교육</td>
                        <td>필수</td>
                        <td>유효기간</td>
                        <td>2020-12-10</td>
                        <td>2020-12-10</td>
                        <td>유효</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal"> 취소</button>
            </div>
        </div>
    </div>
</div>

<!--승인 및 반려 Modal Div-->
<div id="signModal" class="modal fade bs-example-modal-md" tabindex="-1" role="dialog" aria-labelledby="classInfo" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
          <h4 class="modal-title"> 출입신청내역 결재</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> × </button>
      </div>
      <div class="modal-body">
          총 <span class="chkCnt">0</span>건의 신청내역을 <span class="appr-name"></span> 하시겠습니까?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="ok" value="ok" > 확인 </button>
        <button type="button" class="btn btn-primary" data-dismiss="modal"> 취소 </button>
      </div>
    </div>
  </div>
</div>

{% endblock %}